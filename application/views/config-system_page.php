<div class="row"> <?php if($this->session->userdata("user_type")=='admin'){  ?> <div class="col-sm-6 col-md-6 col-lg-6 "> <?php foreach($sh_set as $set ){$name = $set['name']; $type = $set['type']; $file_type_upload = $set['file_type_upload']; $icon = $set['logopic'];  $tel = $set['tel']; $addr = $set['address']; $maxfile = $set['maxfile_size']; } ?> <legend><strong ><span class="glyphicon glyphicon-briefcase" aria-hidden="true"></span> ຂໍ້ມູນອົງກອນ</strong></legend> <div class=" col-sm-4 col-md-4" onclick="$('#file_img').click()" style="cursor:pointer;"> <?php if($icon==''){ ?> <p><img src="<?php echo base_url('images/add-img.png');?>" class="img-thumbnail" id="sh_img" width="150"></p> <?php  } else { ?> <p><img src="<?php echo base_url('images/'.$icon); ?>" class="img-thumbnail" id="sh_img" width="150"></p> <?php }?> </div> <form class="form_img"> <input type="file" name="file_img" id="file_img" style="display: none;" onchange="beforeimg()"> <input type="hidden" name="type" value="update-setting-profile"> </form> <div class=" col-sm-8 col-md-8  "> <div class="form-group"> <div class="input-group"> <div class="input-group-addon ch_of" data='<?php echo $type;?>'> ປະເພດອົງກອນ: </div> <select class="form-control office_type"> <option value="head">ສຳນັກງານໃຫຍ່</option> <option value="brunch">ສາຂາ</option> <option value="unit">ໜ່ວຍບໍລິການ</option> </select> </div> </div> <div class="form-group"> <div class="input-group"> <div class="input-group-addon"> ຊື່ອົງກອນ: </div> <input type="text" class="form-control office_name" value="<?php echo $name; ?>"> </div> </div> <div class="form-group"> <div class="input-group"> <div class="input-group-addon "> ເບີໂທ: </div> <input type="text" class="form-control office_tel" value="<?php echo $tel; ?>" > </div> </div> <div class="form-group"> <div class="input-group"> <div class="input-group-addon "> ທີ່ຢູ່: </div> <input type="text" class="form-control office_address" value="<?php echo $addr; ?>" > </div> </div> <span class="up_ms"></span> </div> <legend><strong ><span class="glyphicon glyphicon-cloud-upload" aria-hidden="true"></span> ຂໍ້ມູນການອັບໂຫລດ</strong></legend> <div class="form-group"> <div class="input-group"> <div class="input-group-addon"> ອັບໂຫລດໄດ້ສູງສຸດ: </div> <input type="text" class="form-control upload_size" value="<?php echo $maxfile; ?>" > <div class="input-group-addon">Kb</div> </div> 1024Kb = 1Mb </div> <input type="hidden" class="file-type" value="<?php echo $file_type_upload;?>"> <label>ປະເພດໄຟລ໌ອັບໂຫລດ:</label> <div class="panel panel-default"> <div class="panel-body"> <span class="box" ><input type="checkbox" class="file-pdf ch"> <i class="fa fa-file-pdf-o"></i> PDF</span> <span class="box" ><input type="checkbox" class="file-jpg ch"> <i class="fa fa-file-image-o"></i> JPG</span> <span class="box" ><input type="checkbox" class="file-png ch"> <i class="fa fa-file-image-o"></i> PNG</span> </div> </div> <div class="row" style="margin: 30px;"> <P align="center"> <button type="button" class="btn btn-info btn-lg save_setting"> <i class="fa fa-save"></i> ບັນທຶກຂໍ້ມູນ</button> </P> </div> </div> <div class="col-sm-6 col-md-6 col-lg-6"> <legend><strong><span class="glyphicon glyphicon-hdd" aria-hidden="true"></span> ຖານຂໍ້ມູນ</strong></legend> <div class="form-group"> <div class="input-group"> <div class="input-group-addon"> ເພີ່ມປີນຳໃຊ້ໃໝ່: </div> <input type="text" class="form-control in-year" placeholder="ປ້ອນປີ 2xxx" maxlength="4" max="2999" > <div class="input-group-addon btn btn-default add-year-btn" > <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></div> </div> </div> <input type="hidden" id="ycount" value="<?php echo $sh_tb_num; ?>" > <ul class="list-group list-year"> <?php   $num_table=0; foreach($sh_sys as $data ){ $num_table++;?> <li class="list-group-item"><span class="glyphicon glyphicon-hdd" aria-hidden="true"></span> Data Base ປີ <?php echo $data['name']?> <div class="media"> <span class="pull-right"> <label ><input type="checkbox" name="used" class="udata<?php echo $data['id'];?>" data_used='<?php echo $data['data_readonly'];?>' <?php if($data['data_readonly']=='1'){echo 'checked';} ?> onclick='check_readonly(<?php echo $data['id']?>)'> ອ່ານຢ່າງດຽວ </label> <span class="glyphicon glyphicon-option-vertical" aria-hidden="true"></span> <label ><input type="radio" name="used" data="<?php echo $data['data_used'];?>" onclick="udata(<?php echo $data['id']?>)" class="used-year<?php echo $data['id']; ?>" <?php if($data['data_used']=='1'){echo 'checked';} ?> > ນຳໃຊ້ຂໍ້ມູນ</label> </span> </div> </li> <?php if($num_table==2){  } } ?> </ul> </div> <?php } else { ?> <div class="container-fluid"> <div class="alert alert-warning alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button> <strong>  ທ່ານບໍ່ມີສິດເຂົ້າເຖິງຂໍ້ມູນ ການຕັ້ງຄ່າລະບົບ!</strong> <br> - ສະເພາະ ຜູ້ດູແລລະບົບ ເທົ່ານັ້ນ! </div> </div> <?php } ?> </div> <script type="text/javascript"> var file_type = $('.file-type').val(); if(file_type!=null){var sp = file_type.split(","); for(var i=0; i<sp.length; i++){if(sp[i]!=''){if(sp[i]=="'image/jpeg'"){ $('.file-jpg').attr('checked', true); } if(sp[i]=="'image/png'"){ $('.file-png').attr('checked', true); } if(sp[i]=="'application/pdf'"){ $('.file-pdf').attr('checked', true); } } } } var urlh = window.location.href; var url = urlh.split('#')[0]; function chy() {var data = $('#ycount').val(); if(data>=2){ $('.add-year-btn').attr('disabled', true); }; } function udata(id) {$('.img-loading').show(); var urlh = window.location.href; var url = urlh.split('#')[0]; var dat = $('.used-year'+id).attr('data'); if(dat=='0'){ $('.used-year'+id).attr('data','1'); $.post(url+'index.php/'+'mdata/update',{ type:'upused', dat:'1',id:id} ,function(data){ $('.img-loading').hide(); location.reload(); }); } } function check_readonly(id) {$('.img-loading').show(); var urlh = window.location.href; var url = urlh.split('#')[0]; var dat = $('.udata'+id).attr('data_used'); if(dat=='0'){$('.udata'+id).attr('data_used','1'); $.post(url+'index.php/'+'mdata/update',{ type:'upreadonly', dat:'1',id:id} ,function(data){ $('.img-loading').hide(); location.reload();  }); } else { $('.udata'+id).attr('data_used','0'); $.post(url+'index.php/'+'mdata/update',{ type:'upreadonly', dat:'0',id:id} ,function(data){ $('.img-loading').hide(); location.reload(); }); } } var chof = $('.ch_of').attr('data'); $('.office_type').val(chof); $('.file-jpg').click(function(event) {if($('.file-jpg').is(':checked')){ var file_type = $('.file-type').val(); $('.file-type').val(file_type+"'image/jpeg',"); } else if($('.file-jpg').is(':not(:checked)')){ var file_type = $('.file-type').val(); var nfile_type = file_type.replace("'image/jpeg',", ''); $('.file-type').val(nfile_type); } check_btn_save(); }); $('.file-pdf').click(function(event) {if($('.file-pdf').is(':checked')){ var file_type = $('.file-type').val(); $('.file-type').val(file_type+"'application/pdf',"); } else if($('.file-pdf').is(':not(:checked)')){ var file_type = $('.file-type').val(); var nfile_type = file_type.replace("'application/pdf',", ''); $('.file-type').val(nfile_type);} check_btn_save(); }); $('.file-png').click(function(event) {if($('.file-png').is(':checked')){ var file_type = $('.file-type').val(); $('.file-type').val(file_type+"'image/png',"); } else if($('.file-png').is(':not(:checked)')){ var file_type = $('.file-type').val(); var nfile_type = file_type.replace("'image/png',", ''); $('.file-type').val(nfile_type); } check_btn_save(); }); $(".in-year").on("keypress keyup blur paste drop",function (event) {$(this).val($(this).val().replace(/[^\d].+/, "")); if ((event.which < 48 || event.which > 57)) {event.preventDefault(); } }); $('.upload_size').on("keypress keyup blur paste drop",function (event) {$(this).val($(this).val().replace(/[^\d].+/, "")); if ((event.which < 48 || event.which > 57)) {event.preventDefault(); } }); $('.add-year-btn').click(function(event) {var datac = $('#ycount').val(); var txt = $('.in-year').val(); if(txt.length =='4'){$.post(url+'index.php/'+'mdata/add',{ type:'add-year', year:txt} ,function(data){$('.in-year').val(''); $('.list-year').append(data); var ndata = parseInt(datac)+1; $('#ycount').val(ndata); }); } }); $('.save_setting').attr('disabled', true); var check_btn_save = function(){var name = $('.office_name').val(), tel = $('.office_tel').val(), type = $('.office_type').val(), addre = $('.office_address').val(), upload_size = $('.upload_size').val(), file_type = $('.file-type').val(); if(name!=''){if(tel!=''){if(type!=null){if(addre!=''){if(upload_size!=''){if(file_type!=''){$('.save_setting').attr('disabled', false); } else { $('.save_setting').attr('disabled', true); } } else { $('.save_setting').attr('disabled', true);} } else { $('.save_setting').attr('disabled', true);} } else { $('.save_setting').attr('disabled', true);} } else { $('.save_setting').attr('disabled', true);} } else { $('.save_setting').attr('disabled', true);} }; $('.office_name').keyup(function(event) {check_btn_save(); }); $('.office_tel').keyup(function(event) {check_btn_save(); }); $('.office_address').keyup(function(event) {check_btn_save(); }); $('.upload_size').keyup(function(event) {check_btn_save(); }); $('.office_type').change(function(event) {check_btn_save(); }); $('.save_setting').click(function(event) { $('.img-loading').show(); var name = $('.office_name').val(), tel = $('.office_tel').val(), type = $('.office_type').val(), addre = $('.office_address').val(), upload_size = $('.upload_size').val(),file_type = $('.file-type').val(); if(name!=''&& tel!=''&&type!=null&&addre!=''&&upload_size!=''&&file_type!=''){$('.save_setting').attr('disabled', true); $('.save_setting').html('<i class="fa fa-refresh fa-spin fa-fw"></i> ກຳລັງບັນທຶກ....'); $.post(url+'index.php/'+'mdata/update',{ type:'update-setting', name:name,tel:tel,file_type:file_type,office_type:type,address:addre,upload_size:upload_size} ,function(data){var intrvl = setInterval(function(){ $('.save_setting').html('<i class="fa fa-check-circle-o" ></i> ບັນທືກ ຂໍ້ມູນສຳເລັດ!!'); clearInterval(intrvl); var intrvle = setInterval(function(){ $('.save_setting').html('<i class="fa fa-save"></i> ບັນທຶກຂໍ້ມູນ'); clearInterval(intrvle); $('.img-loading').hide();  location.reload(); },800); },800); }); } }); var beforeimg = function(){if (window.File && window.FileReader && window.FileList && window.Blob) {var fsize = $('#file_img')[0].files[0].size; var ftype = $('#file_img')[0].files[0].type; switch(ftype) {case 'image/jpeg': case 'image/JPG':break; default:$(".up_ms").html("<p><div class='alert alert-danger'> <span class='glyphicon glyphicon-ban-circle'></span> <b>"+ftype+"</b> ໄຟລ໌ທີ່ອັບໂຫລດ ໂລໂກ້ ຕ້ອງເປັນປະເພດ JPG</div></p>"); document.getElementById("sh_img").src = url + 'images/add-img.png'; return false } if(fsize>1048576*1) {$(".up_ms").html("<p><div class='alert alert-danger'> <span class='glyphicon glyphicon-ban-circle'></span>  <b>"+ bytesToSize(fsize) +"</b> ໄຟລ໌ທີ່ອັບໂຫລດ ຕ້ອງບໍ່ຫລາຍກ່ວາ 1Mb.</div></p?"); document.getElementById("sh_img").src = url + 'images/add-img.png'; return false } var oFReader = new FileReader();oFReader.readAsDataURL(document.getElementById("file_img").files[0]);oFReader.onload = function (oFREvent) {document.getElementById("sh_img").src = oFREvent.target.result;}; $('.form_img').submit(); $(".up_ms").html(""); } else { $(".up_ms").html("Please upgrade your browser, because your current browser lacks some new features we need!"); $("#in_msg").html(""); return false; } }; $('.form_img').on('submit',(function(e) {var urlh = window.location.href; var url = urlh.split('#')[0]; e.preventDefault(); $.ajax({url: url + 'index.php/mdata/update', type: "POST", data: new FormData(this), contentType: false, cache: false, processData:false,  success: function(data) {}, error: function(data){$(".up_ms").html('<div class="alert alert-danger alert-dismissable top10"><i class="fa fa-ban"></i><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><b>ການບັນທຶກຂໍ້ມູນບໍ່ສຳເລັດ!</b> ລະບົບບໍ່ສາມາດ ບັນທືກຂໍ້ມູນ ຂອງທ່ານໄດ້!.</div>'); } }); })); function bytesToSize(bytes) {var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']; if (bytes == 0) return '0 Bytes'; var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024))); return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i]; }; </script>